<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="CSS/style.css">
    <!-- Add Font Awesome CDN (optional) -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // All your mapping code + event listeners go here
        const regionToDistrict = {
          "accra-east": "kwabenya",
          "accra-west": "amasaman"
        };
    
        const locations = {
          kwabenya: [
            "Ablorgyei", "Abokobi", "Abokobi Boi", "Abokobi Seseme", "Agbogba", "Ashongman", "Comet", "Dome",
            "Dome Crossing", "Dome PIllar II", "Franko Estate", "Haatso", "Kissieman (Christian  Village)", "Kwabenya",
            "Madina Lybya Quaters", "Madina Zongo", "North Legon", "Taifa", "West Legon (West Land)"
          ],
          amasaman: [
            "Achiaman","Ademan","Akotoshie","Akramaman","Amasaman Abehenase","Amasaman Cocobod","Amasaman Darasalam",
            "Amasaman Fise","Amasaman Shipontele","Amasaman Tooman","Ayikaidoblo","Doblogono","Kotoku","Kwasiekuma","Manchi",
            "Medie","Obeyeyie","Odumase","Okushiebeade","Onyansah","Opah","Otuapre","Pokuase Dunyo","Pokuase Abensu","Pokuase Acp Estate /Knust",
            "Pokuase Adusah","Pokuase Afiaman","Pokuase Amfrum","Pokuase Amomole", "Pokuase Katapor","Pokuase Mayira","Pokuase Osofoman","Samsam",
            "Sapeman","Satelite Abloman","Satelite Damax 1 & 2","Satelite Hans Lodge  Area","Satelite Koans Estate","Satelite Kpobiman","Satelite Mercidonia",
            "Satelite Opah","Satelite Treba","Yahoman"
          ]
        };
    
        function updateDistrictAndLocations() {
          const region = document.getElementById("region").value;
          const districtSelect = document.getElementById("district");
    
          const districtValue = regionToDistrict[region];
          if (districtValue) {
            districtSelect.value = districtValue;
            updateLocations();
            localStorage.setItem("selectedDistrict", districtSelect.value);

          }
        }
    
        function updateLocations() {
          const district = document.getElementById("district").value;
          const locationSelect = document.getElementById("location");
          locationSelect.innerHTML = "<option value=''>Select a location</option>";
    
          if (locations[district]) {
            locations[district].forEach(loc => {
              const option = document.createElement("option");
              option.value = loc.toLowerCase();
              option.textContent = loc;
              locationSelect.appendChild(option);
            });
          }
        }
    
        document.getElementById("region").addEventListener("change", updateDistrictAndLocations);
        document.getElementById("district").addEventListener("change", updateLocations);
      });
    </script>
    
    <title>OpenDistrict - Choose district</title>
</head>

<body class="min-h-screen bg-blue-100 flex flex-col px-4 py-10">

  <header class="bg-white shadow fixed w-full top-0 left-0 z-50">
  <div class="container mx-auto flex justify-between items-center px-6 py-4">
    <!-- Logo -->
    <div class="text-2xl font-bold text-black-600">
      OpenDistrict
    </div>

    <!-- Navigation -->
    <nav class="flex space-x-8 items-center">
      <a href="/index.html" class="text-gray-800 hover:text-red-600 font-medium">Home</a>
      
      <!-- News Dropdown -->
      <div class="relative group">
        <button class="text-gray-800 hover:text-red-600 font-medium focus:outline-none">
          News
          <i class="fas fa-chevron-down ml-1 text-xs"></i>
        </button>
        <div class="absolute right-0 mt-2 w-60 bg-white border border-gray-200 rounded shadow-lg opacity-0 group-hover:opacity-100 invisible group-hover:visible transition duration-200">
          <a href="./Pages/ga-west news.html" class="block px-4 py-2 text-gray-700 hover:bg-red-50 hover:text-red-600">Ga-West Municipal News</a>
          <a href="./Pages/ga-east news.html" class="block px-4 py-2 text-gray-700 hover:bg-red-50 hover:text-red-600">Ga-East Municipal News</a>
        </div>
      </div>
    </nav>
  </div>
</header>

<div class="pt-24 w-full flex flex-col items-center">
    <div
        class="bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-2xl shadow-2xl p-4 sm:p-6 max-w-lg w-full space-y-6">
        <h2 class="text-2xl sm:text-3xl font-extrabold text-center">Choose your location</h2>

       <!-- Region (hardcoded for now) -->
       <div class="mb-4">
        <label class="block text-white-700 font-semibold mb-1" for="region">Region</label>
        <select id="region" name="region" class="w-full px-4 py-2 text-sm rounded-lg border border-gray-300 bg-gray-50 focus:ring-2 focus:ring-purple-500 focus:outline-none dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400">
          <option disabled selected value="">Select your region</option>
          <option value="accra-east">Ga East Region</option>
          <option value="accra-west">Ga West Region</option>
        </select>
        <p id="region-error" class="hidden text-sm text-red-500 mt-1">Please select your region.</p>
      
      </div>
  
      <!-- District -->
      <div class="mb-4">
        <label class="block text-white-700 font-semibold mb-1" for="district">District</label>
        <select disabled id="district" name="district" class="w-full px-4 py-2 text-sm rounded-lg border border-gray-300 bg-gray-50 focus:ring-2 focus:ring-purple-500 focus:outline-none dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400" onchange="updateLocations()">
          <option disabled selected value="">Select your district</option>
          <option value="kwabenya">Kwabenya District</option>
          <option value="amasaman">Amasaman District</option>
        </select>
        <p id="district-error" class="hidden text-sm text-red-500 mt-1">Please select a district.</p>
      </div>
  
      <!-- Location under District -->
      <div class="mb-4">
        <label class="block text-white-700 font-semibold mb-1" for="location">Location</label>
        <select id="location" name="location" class="w-full px-4 py-2 text-sm rounded-lg border border-gray-300 bg-gray-50 focus:ring-2 focus:ring-purple-500 focus:outline-none dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400">
          <option value="">Select a location</option>
          <!-- Options will be filled based on selected district -->
        </select>
        <p id="location-error" class="hidden text-sm text-red-500 mt-1">Please select your location.</p>
      </div>
      
      <!-- GPS Location Input -->
<div class="mb-4">
  <label class="block text-white-700 font-semibold mb-1" for="gps-location">GPS Location</label>
  <input
    type="text"
    id="gps-location"
    name="gps_location"
    placeholder="Tap to get your location..."
    readonly
    class="w-full px-4 py-2 text-sm rounded-lg border border-gray-300 bg-gray-50 focus:ring-2 focus:ring-purple-500 focus:outline-none dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400"
  />
  <p id="gps-error" class="hidden text-sm text-red-500 mt-1">Unable to fetch your location.</p>
</div>
<!-- Google Map -->
<div id="map" class="w-full h-64 mb-4 rounded-lg" style="display: none;"></div>


  
      <a href="/Pages/selectissue.html">
          <button id="continue-btn" type="button"
              class="text-gray-900 bg-white border border-gray-300 focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-100 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2 dark:bg-gray-800 dark:text-white dark:border-gray-600 dark:hover:bg-gray-700 dark:hover:border-gray-600 dark:focus:ring-gray-700">
              Continue
          </button>
        </a>
        <script>
              document.addEventListener("DOMContentLoaded", function () {
                // When district or location is selected, save them in localStorage
                const districtSelect = document.getElementById("district");
                const locationSelect = document.getElementById("location");
            
                // Save district
                districtSelect.addEventListener("change", function () {
                  localStorage.setItem("selectedDistrict", districtSelect.value);
                });
            
                // Save location
                locationSelect.addEventListener("change", function () {
                  localStorage.setItem("selectedLocation", locationSelect.value);
                });
              });
              </script>

<script>
  document.getElementById('continue-btn').addEventListener('click', function (e) {
    e.preventDefault(); // Prevent unintended submission or default behavior

    const region = document.getElementById('region');
    const district = document.getElementById('district');
    const location = document.getElementById('location');
    const regionError = document.getElementById('region-error');
    const districtError = document.getElementById('district-error');
    const locationError = document.getElementById('location-error');
    

    let hasError = false;

    // Reset all error messages
    regionError.classList.add('hidden');
    districtError.classList.add('hidden');
    locationError.classList.add('hidden');
    

    // Check region
    if (region.value === "") {
      regionError.classList.remove('hidden');
      hasError = true;

    }// Check district
    if (district.value === "") {
      districtError.classList.remove('hidden');
      hasError = true;
    }

    // Check location
    if (location.value === "") {
      locationError.classList.remove('hidden');
      hasError = true;
    }

    if (!hasError) {
    window.location.href = "/Pages/selectissue.html";
  }

  });
</script>
<script>
  let map, marker, geocoder;

  function initMap() {
    geocoder = new google.maps.Geocoder();

    const input = document.getElementById("gps-location");
    const mapDiv = document.getElementById("map");

    input.addEventListener("click", function () {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            const latLng = {
              lat: position.coords.latitude,
              lng: position.coords.longitude,
            };

            mapDiv.style.display = "block"; // Show map

            map = new google.maps.Map(mapDiv, {
              center: latLng,
              zoom: 16,
            });

            marker = new google.maps.Marker({
              position: latLng,
              map: map,
              draggable: true,
            });

            // Reverse geocode initial position
            geocodeLatLng(latLng);

            // Update address when marker is dragged
            marker.addListener("dragend", () => {
              const newPos = marker.getPosition();
              geocodeLatLng({
                lat: newPos.lat(),
                lng: newPos.lng(),
              });
            });
          },
          () => {
            document.getElementById("gps-error").classList.remove("hidden");
          }
        );
      } else {
        document.getElementById("gps-error").classList.remove("hidden");
      }
    });
  }

  function geocodeLatLng(latLng) {
    geocoder.geocode({ location: latLng }, (results, status) => {
      if (status === "OK") {
        if (results[0]) {
          document.getElementById("gps-location").value = results[0].formatted_address;
        } else {
          document.getElementById("gps-location").value = "No address found";
        }
      } else {
        document.getElementById("gps-location").value = "Geocoder failed: " + status;
      }
    });
  }
</script>

<script async defer
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBd_LkxA1z_FL252ix8H9oB5btCu_j3Lbg&callback=initMap">
</script>
          
  </body>
  </html>

 
