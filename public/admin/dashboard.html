<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Cache-Control" content="no-store" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <title>Dashboard</title>


  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap');
      body {
        font-family: "Montserrat", sans-serif;      
      }
    </style>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
    }
  </script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />




  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const name = localStorage.getItem('adminName');
      const district = localStorage.getItem('adminDistrict');
  
      if (!name || !district) {
        // Clear any existing data and redirect
        localStorage.clear();
        window.location.href = '../admin-login.html';
      }
    });
  </script>
</head>
<body>

  <div class="flex min-h-screen bg-gray-100 dark:bg-slate-950">
    <!-- Sidebar -->
    <div class="w-64 h-screen bg-gray-900 text-white dark:border-r dark:border-gray-700 p-4 flex flex-col">
      <h4 class="text-xl font-bold mb-4">OpenDistrict</h4>
      <hr class="border-gray-700 mb-4" />
      
      <nav class="flex flex-col space-y-2 flex-grow">
        <a href="#" onclick="navigateWithParams('dashboard.html')" class="bg-gray-700 px-3 py-2 rounded text-white">Dashboard</a>
        <a href="#" onclick="navigateWithParams('ofcomplaints.html')" class="hover:bg-gray-700 px-3 py-2 rounded text-gray-300">Complaints</a>
      </nav>
    
      <!-- Dark Mode Toggle Switch at the bottom -->
      <div class="mt-auto pt-6">
        <div class="flex items-center justify-between px-3 text-sm font-medium text-white">
          <span>Dark Mode</span>
          <label class="relative flex items-center cursor-pointer w-12 h-6">
            <!-- The peer checkbox -->
            <input type="checkbox" id="darkModeSwitch" class="sr-only peer" />
          
            <!-- The background track -->
            <div class="w-full h-full bg-gray-400 rounded-full peer-checked:bg-blue-600 transition-colors duration-300"></div>
          
            <!-- The knob (sibling of the .peer input) -->
            <div class="absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full transition-transform duration-300 transform peer-checked:translate-x-6"></div>
          </label>
          
        </div>
      </div>
    </div>
    

    <!-- Main Content -->
    <div class="flex-grow">
      <!-- Top Bar -->
      <nav class="bg-sky-500 text-white px-6 py-4 flex justify-between items-center">
        <div class="text-lg font-semibold">Dashboard - <span id="district-name"></span> District</div>   
        
        <div class="flex items-center gap-6">
            <!-- User Initial with Dropdown -->
            <div class="relative">
            <!-- Profile Button -->
              <button id="profileButton" class="w-9 h-9 rounded-full bg-white text-black flex items-center justify-center font-semibold focus:outline-none"></button>

              <!-- Dropdown Menu -->
              <div id="profileDropdown" class="absolute right-0 top-full mt-2 w-64 bg-gray-800 shadow-lg rounded-md z-50 hidden">
                <div class="p-4 border-b">
                  <div class="flex items-center space-x-3">
                    <div id="initials" class="w-9 h-9 rounded-full bg-white flex items-center justify-center font-semibold text-black ">  </div>
                    <div>
                      <p id="profile-name" class="font-semibold text-sm text-white"></p>
                    </div>
                  </div>
                </div>
                <div class="p-3 text-sm text-white space-y-2">
                  <a href="#" onclick="logout()" class="block text-red-500 hover:text-red-700 font-semibold">Log Out</a>    
                </div>
              </div>
          </div>
        </div>
      </nav>

      <!-- Dashboard Cards -->
      <div class="p-6">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          
          <!-- Total Complaints -->
          <div class="bg-sky-500 text-white p-6 rounded-lg shadow flex justify-between items-center">
            <div>
              <h2 class="text-3xl font-bold" id="complaintCount">0</h2>              
              <p>Total Complaints</p>  
            </div>
            <i class="fas fa-comments fa-3x opacity-40"></i>
          </div>

          <!-- Pending -->
          <div class="bg-yellow-400  text-white p-6 rounded-lg shadow flex justify-between items-center">
            <div>
              <h2 id="pending-count" class="text-3xl font-bold">0</h2>
              <p>Pending</p>
            </div>
            <i class="fas fa-hourglass-half fa-3x opacity-40"></i>
          </div>

          <!-- Complaints Solved -->
          <div class="bg-green-600 text-white p-6 rounded-lg shadow flex justify-between items-center">
            <div>
              <h2 id="solved-count" class="text-3xl font-bold">0</h2>
              <p>Complaints Solved</p>
            </div>
            <i class="fas fa-check-circle fa-3x opacity-40"></i>
          </div>


        </div>
      </div>

    </div>
  </div>

<!-- Confirmation Modal -->
<div id="logoutModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
  <div class="bg-white p-6 rounded shadow-lg text-center">
    <p class="mb-4 text-lg">Are you sure you want to log out?</p>
    <button onclick="performLogout()" class="bg-red-600 text-white px-4 py-2 rounded mr-4">Yes</button>
    <button onclick="closeModal()" class="bg-gray-400 px-4 py-2 rounded">Cancel</button>
  </div>
</div>

  <!-- Loading Spinner -->
  <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
    <div class="loader ease-linear rounded-full border-4 border-t-4 border-white h-12 w-12 animate-spin"></div>
  </div>

  <!-- Spinner Styles -->
  <style>
    .loader {
      border-top-color: #4F46E5; /* Indigo-600 */
    }
  </style>
    




<script>
  function logout() {
    document.getElementById('logoutModal').classList.remove('hidden');
  }

  function closeModal() {
    document.getElementById('logoutModal').classList.add('hidden');
  }

  function performLogout() {
    // Hide modal and show loading spinner
    closeModal();
    document.getElementById('loadingOverlay').classList.remove('hidden');

    // Simulate logout delay
    setTimeout(() => {
      // Clear admin data
      localStorage.removeItem('adminName');
      localStorage.removeItem('adminDistrict');

      // Redirect to login page
      window.location.href = '../admin-login.html';
    }, 2000); // 2 seconds delay
  }
</script>



  <script>
    const checkbox = document.getElementById('darkModeSwitch');

    if (localStorage.getItem('theme') === 'dark') {
      document.documentElement.classList.add('dark');
      checkbox.checked = true;
    }

    checkbox.addEventListener('change', () => {
      if (checkbox.checked) {
        document.documentElement.classList.add('dark');
        localStorage.setItem('theme', 'dark');
      } else {
        document.documentElement.classList.remove('dark');
        localStorage.setItem('theme', 'light');
      }});
  </script>
  <script>
    const profileButton = document.getElementById("profileButton");
    const profileDropdown = document.getElementById("profileDropdown");

    profileButton.addEventListener("click", () => {
      profileDropdown.classList.toggle("hidden");
    });

    // Optional: Hide dropdown when clicking outside
    document.addEventListener("click", (e) => {
      if (!profileButton.contains(e.target) && !profileDropdown.contains(e.target)) {
        profileDropdown.classList.add("hidden");
      }
    });
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const name = localStorage.getItem('adminName');
      const district = localStorage.getItem('adminDistrict');

      if (name) {
        document.getElementById('profile-name').textContent = name;

        const initials = name
        .split(' ')
        .map(word => word.charAt(0).toUpperCase())
        .join('')
        .slice(0, 2);

        document.getElementById('initials').textContent = initials;
        document.getElementById('profileButton').textContent = initials;

      }
      if (district) {
        document.getElementById('district-name').textContent = district;
        fetch(`/api/complaints/count?district=${district}`)
        .then(response => response.json())
          .then(data => {
            if (data.count !== undefined) {
              document.getElementById('complaintCount').textContent = data.count;
            }
          })
          .catch(err => {
            console.error("Failed to fetch complaint count:", err);
          });
      }
    });
  </script>
  <script>
    function navigateWithParams(page) {
      const district = localStorage.getItem('adminDistrict');
      const name = localStorage.getItem('adminName');

      if (district && name) {
        // Navigate without putting data in the URL
        window.location.href = page;
        
      } else {
        // Optionally handle missing data
        console.warn('Missing admin data. Redirecting to login.');
        window.location.href = 'admin-login.html'; // or any fallback
      }
    }
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const district = localStorage.getItem('adminDistrict');

      async function fetchCount(status, elementId) {
        if (!district) return;
        try {
          const response = await fetch(`/api/complaints/count?district=${encodeURIComponent(district)}&status=${encodeURIComponent(status)}`);
          const data = await response.json();
          if (data.count !== undefined) {
            document.getElementById(elementId).textContent = data.count;
          }
        } catch (err) {
          console.error(`Failed to fetch ${status} count:`, err);
        }
      }
      
      fetchCount('pending', 'pending-count');
      fetchCount('solved', 'solved-count');
    });
  </script>

  



</body>
</html>
